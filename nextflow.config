apptainer.enabled = true

params {
    //lastStep = "align"
    sampleFile = "samples.tsv"
    sampleFileSep = "\t"
    humid = null

    general {
        publish {
            // Nextflow publishDir param for all processes
            // https://www.nextflow.io/docs/latest/process.html#publishdir
            mode = "copy"

            // Where to publish results of Hich processes
            genomeReference = "resources/hich/genomeReference"
            chromsizes = "resources/hich/chromsizes"
            bwa_mem2Index = "resources/hich/bwa-mem2"
            bwaIndex = "resources/hich/bwa"
            fragmentIndex = "resources/hich/fragmentIndex"

            align = "results/align"
            parse = "results/pairs/parse"
            dedup = "results/pairs/dedup"
            mcool = "results/matrix/mcool"
            hic = "results/matrix/hic"
            pairStats = "results/pairStats"
            qc = "results/qc"
        }
        
        // After these steps, generate read-level pairs 
        // stats files and generate a combined MultiQC report
        // for all samples at each processing stage
        qcAfter = ["Parse",
                    "IngestPairs",
                    "TagFragments",
                    "TechrepsToBioreps",
                    "Deduplicate",
                    "BiorepsToConditions",
                    "Select"]
        
        // Number of reads to downsample to by default for a humid run
        // can also be specified simply via --humid 100000 or similar
        humidDefault = 100000
    }

    comparisonSets {
        hicrep {
            p1 {
                resolutions = [100000, 1000000]
                chroms = []
                exclude = ["chrY", "chrM"]
                chromFilter = "chrom if size > 5000000 else None"
                h = [1]
                dBPMax = [-1]
                bDownSample = [false]
            }
            p2 {
                resolutions = [100000, 1000000]
                chroms = []
                exclude = ["chr1", "chr2", "chr3", "chr4", "chr5", "chr6", "chr7", "chr8", "chr9", "chr10", "chrY", "chrM"]
                chromFilter = "chrom if size > 5000000 else None"
                h = [1]
                dBPMax = [-1]
                bDownSample = [false]
            }
        }

        mustacheLoops {
            mustacheLoops1 {
                mustacheParams = [
                "--resolution 1000000",
                "--chromosome chr22",
                "--pThreshold .1",
                "--sparsityThreshold .88"
                ]
            }
        }
    }

    defaults {
        techrep = 1
        biorep = 1
        minMapq = 30
        
        deduplicate = true

        datatype = "fastq"
        aligner = "bwa-mem2"
        alignerThreads = 10
        bwaFlags = "-SP5M"

        pairsFormat {
            chrom1 = 2
            pos1 = 3
            chrom2 = 4
            pos2 = 5
        }

        parseParams = [
           "--flip",
           "--min-mapq 30",
           "--drop-readid",
           "--drop-seq",
           "--drop-sam"
        ]

        pairtoolsDedupParams = []

        pairtoolsSelectParams = []
            
        selectFilters {
            keepPairTypes = ["UU", "RU", "UR"]
            keepTrans = true
            keepCis = true
            minDistFR = 1000
            minDistRF = 1000
            minDistFF = 0
            minDistRR = 0

            chroms = ["chr1", "chr2", "chr3", "chr4", "chr5", "chr6",
                        "chr7", "chr8", "chr9", "chr10", "chr11", "chr12",
                        "chr13", "chr14", "chr15", "chr16", "chr17", "chr18",
                        "chr19", "chr20", "chr21", "chr22", "chrX"]
            
            discardSingleFrag = true
        }

        juicerToolsPreParams = []

        coolerCloadParams = []

        coolerZoomifyParams = [
            "--balance",
            "--balance-args '--max-iters 2000 --trans-only'",
            "--nproc 10"
        ]

        matrix {
            makeMcoolFileFormat = true
            makeHicFileFormat = true
            resolutions = [100000, 1000000]
        }

        hicrepComparisonSets = ["p1", "p2"]
        mustacheLoopsComparisonSets = ["mustacheLoops1"]

        compartments {
            resolution = 100000
            hichCompartmentsParams = [
                "--n_eigs 3"
            ]
        }

        insulation {
            resolution = 100000
            cooltoolsInsulationParams = [
                "--bigwig"
            ]
        }        
    }
}
