FROM condaforge/mambaforge:4.10.3-9

# Set the working directory
WORKDIR /hich
USER root

RUN apt-get update && apt-get install -y gcc g++ make build-essential
COPY ./environment.yml /hich
RUN mamba env update --name base environment.yml
RUN mamba install bzip2 samtools bwa bwa-mem2 -c conda-forge -c bioconda -y

COPY . /hich
RUN poetry config virtualenvs.create false \
   && poetry install --no-interaction --no-ansi