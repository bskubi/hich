nextflow_workflow {

    name "Test Workflow CompartmentScores"
    script "contents/subwf/features/CompartmentScores/workflow.nf"
    workflow "CompartmentScores"

    test("SmokeTest_CompartmentScores") {
        tag "1to3m"
        when {
            params {
                sampleSelectionStrategies = [
                    strategy1: [:]
                ]
                compartments = [
                    plan1: [
                        sampleSelectionStrategy: ["strategy1"],
                        resolution: 1000000,
                        cooltools_eigs_cis_opts: [
                            "--n-eigs": 3,
                            "--ignore-diags": 3,
                            "--regions": "$projectDir/tests/assets/views/hg38.chr19.bed"
                        ]
                    ]
                ]
            }
            workflow {
                """
                genomeReference = file("$projectDir/tests/assets/downloads/genomeReference/hg38.fa.gz")
                matrix = file("$projectDir/tests/assets/downloads/mcool/full/GSM4604274_629.iced.mcool")
                samples = [
                    [id: "1", genomeReference: genomeReference, mcool: matrix]
                ]
                input[0] = channel.fromList(samples)
                """
            }
        }

        then {
            assert workflow.success
        }

    }

}
