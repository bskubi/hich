nextflow_workflow {

    name "Test Workflow McoolMatrix"
    script "contents/subwf/matrix/McoolMatrix/workflow.nf"
    workflow "McoolMatrix"

    test("SmokeTest_McoolMatrix") {
        options """-profile localPC""""
        tag "priority1"
        
        when {
            params {
            }
            workflow {
                """
                pairs = file("$projectDir/tests/assets/pairs/1k/1k_Formaldehyde+DSG_DdeI_and_DpnII_HFFc6_BR1_TR1.drop.pairs.gz")
                chromsizes = file("$projectDir/tests/assets/chromsizes/hg38.sizes")
                common = [
                    latestPairs: pairs, 
                    matrix_opts: [plan_name: "plan1", resolutions: [1000000, 2000000, 5000000]],
                    chromsizes: chromsizes
                ]

                samples = [
                    [id: "1", skipMcoolFileFormat: false] + common,
                    [id: "2", skipMcoolFileFormat: true] + common
                ]
                input[0] = channel.fromList(samples)
                """
            }
        }

        then {
            assert workflow.success
            with (workflow.out) {
                assert samples.size() == 2
                assert samples.findAll{it.mcool}.size() == 1
            }
        }

    }

}
