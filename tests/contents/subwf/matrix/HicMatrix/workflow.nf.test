nextflow_workflow {

    name "Test Workflow HicMatrix"
    script "contents/subwf/matrix/HicMatrix/workflow.nf"
    workflow "HicMatrix"

    test("SmokeTest_HicMatrix") {
        tag "priority1"
        options """-profile localPC""""
        
        when {
            params {
            }
            workflow {
                """
                pairs = file("$projectDir/tests/assets/pairs/1k/1k_Formaldehyde+DSG_DdeI_and_DpnII_HFFc6_BR1_TR1.drop.pairs.gz")
                chromsizes = file("$projectDir/tests/assets/chromsizes/hg38.sizes")
                common = [
                    latestPairs: pairs, 
                    matrix_opts: [plan_name: "plan1", resolutions: [1000000, 2000000, 5000000], juicer_tools_pre: ["-n":true]], 
                    chromsizes: chromsizes
                ]

                samples = [
                    [id: "1", skipHicFileFormat: false] + common,
                    [id: "2", skipHicFileFormat: true] + common
                ]
                input[0] = channel.fromList(samples)
                """
            }
        }

        then {
            assert workflow.success
            with (workflow.out) {
                assert samples.size() == 2
                assert samples.findAll{it.hic}.size() == 1
            }
        }

    }

}
