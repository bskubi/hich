**Workflow Control**
================
*Test, pause, resume and rerun*
-----------------------------

Install Nextflow, package manager, and Hich
-------------------------------------------
If not already installed, install `Nextflow <https://www.nextflow.io/docs/latest/install.html>`_ and one of the following dependency managers `Singularity <https://docs.sylabs.io/guides/3.0/user-guide/installation.html>`_, `Docker <https://docs.docker.com/engine/install/>`_, `Conda <https://conda.io/projects/conda/en/latest/user-guide/install/index.html>`_, or `Mamba <https://www.google.com/search?q=mamba+install&oq=mamba+install&gs_lcrp=EgZjaHJvbWUyFAgAEEUYORhDGIMBGLEDGIAEGIoFMgwIARAAGEMYgAQYigUyDAgCEAAYQxiABBiKBTIMCAMQABhDGIAEGIoFMgwIBBAAGEMYgAQYigUyBggFEEUYPDIGCAYQRRg8MgYIBxBFGDzSAQc5NjZqMGo3qAIAsAIA&sourceid=chrome&ie=UTF-8>`_

Clone Hich into your home directory
-----------------------------------

The ``~`` character is for your home directory. Change it to the path where you'd like to download Hich.

.. code-block:: console

    git clone https://github.com/bskubi/hich.git ~ && cd ~/hich

Stub, humid, partial and full runs
----------------------------------

.. note::
    This vignette shows how to run Hich using any of four dependency management solutions:
    Singularity, Docker, Conda or Mamba. Choose the version that fits your setup.

    If running on an HPC such as SLURM, you may need to create a batch file to run the following commands.

A **stub run** is a Nextflow built-in feature to check that the intended processes will be called in the correct order, but does no actual processing. It takes a few seconds to run and produces empty files as outputs in the `hich/resources` and `hich/results` directories.

.. code-block:: console

    nextflow run hich.nf --singularity.enabled -stub-run
    nextflow run hich.nf --docker.enabled -stub-run
    nextflow run hich.nf --conda.enabled -stub-run
    nextflow run hich.nf --conda.enabled --conda.useMamba --humid

A **humid run** is a Hich feature to quickly check that the processing works as intended. Hich downsamples the input data, then runs the workflow on the downsampled data. If no stub or humid option is given, Hich runs on the complete dataset.

.. code-block:: console

    nextflow run hich.nf --singularity.enabled --humid
    nextflow run hich.nf --docker.enabled --humid
    nextflow run hich.nf --conda.enabled --humid
    nextflow run hich.nf --conda.enabled --conda.useMamba --humid

A **last step** option inserts a pause point in the Hich workflow, which can be useful to QC the data before a more time-intensive processing step. It can be used with stub and humid runs.

.. code-block:: console

    nextflow run hich.nf --singularity.enabled --general.last_step select
    nextflow run hich.nf --docker.enabled --general.last_step select
    nextflow run hich.nf --conda.enabled --general.last_step select
    nextflow run hich.nf --conda.enabled --conda.useMamba --general.last_step select


A **resume** option picks up where the previous run left off, using files cached in the ``work`` directory. It can be used with stub and humid runs, and will use the appropriate stub or humid run generated cached data.

.. code-block:: console

    nextflow run hich.nf --singularity.enabled -resume
    nextflow run hich.nf --docker.enabled -resume
    nextflow run hich.nf --conda.enabled -resume
    nextflow run hich.nf --conda.enabled --conda.useMamba -resume

If none of the above options are used, Hich runs on the complete dataset from start to finish, reprocessing even if cached previous results exist.

.. code-block:: console

    nextflow run hich.nf --singularity.enabled
    nextflow run hich.nf --docker.enabled
    nextflow run hich.nf --conda.enabled
    nextflow run hich.nf --conda.enabled --conda.useMamba